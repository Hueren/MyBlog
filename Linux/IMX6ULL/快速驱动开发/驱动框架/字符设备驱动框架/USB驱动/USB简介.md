## USB

USB是一种支持热插拔的总线接口，使用差分线 (D-和 D+)来传输数据， USB支持两种供
电模式：总线供电和自供电，总线供电就是由 USB接口为外部设备供电，在 USB2.0下，总线供电最大可以提供 500mA的电流。

USB只能主机与设备之间进行数据通信， USB主机与主机、设备与设备之间是不能通信的。
因此两个正常通信的 USB接口之间必定有一个主机，一个设备。为此使用了不同的插头和插座来区分主机与设备，比如主机提供 USB A插座，从机提供 Mini USB、 Micro USB等插座。在一个 USB系统中，仅有一个 USB主机，但是可以有多个 USB设备，包括 USB功能设备和 USB HUB，最多支持 127个设备。一个 USB主控制器支持 128个地址，地址 0是默认地址，只有在设备枚举的时候 才会使用，地址 0不会分配给任何一个设备。所以一个 USB主控制器最多可以分配 127个地址。整个 USB的拓扑结构就是一个分层的金字塔形

<img src="file:///D:/MyBlog/docs/images/2024-04-25-11-16-08-image.png" title="" alt="" data-align="center">

## USB_OTG

OTG是 On-The-Go的缩写，支持 USB OTG功能的 USB接口既可以做 HOST也可以做 DEVICE。ID线的高低电平表示 USB口工作在 HOST还是 DEVICE模式。

| ID  | 模式  |
|:---:|:---:|
| 1   | 从机  |
| 0   | 主机  |

# USB协议

## USB描述符

USB描述符就是用来描述 USB信息的，描述符就是一串按照一定规则构建的字符串， USB设备使用描述符来向主机报告自己的相关属性信息。

### 设备描述符

### 配置描述符

### 字符串描述符

### 接口描述符

### 端口描述符

## USB数据包类型

USB是串行通信，需要一位一位的去传输数据， USB传输的时候先将原始数据进行打包，
所以 USB中传输的基本单元就是数据包。根据用途的不同， USB协议定义了 4种不同的包结
构：令牌 (Token)包、数据 (Data)包、握手 (Handshake)包和特殊 (Special)包。这四种包通过包标识符 PID来区分， PID共有 8位， USB协议使用低 4位 PID3~PID0，另外的高四位 PID7~PID4是PID3~PID0的取反 ，传输顺序是 PID0、 PID1、 PID2、 PID3…PID7。令牌包的 PID1~0为 01，数据包的 PID1~0为 11，握手包的 PID1~0为 10，特殊包的 PID1~0为 00。每种类型的包又有多种具体的包

## USB传输类型

## USB枚举




